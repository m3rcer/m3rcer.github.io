---
title: PhishLanding
date: 2022-04-02 09:48:47 +07:00
categories: RedTeaming
#modified: 20-08-29 09:24:47 +07:00
#tags: [blog, netlify, jekyll, github]
description: Dark/Clear Web Hosting Providers for your SMTP builds!
---

# Phishing Build Operations and Infrastructure


This is a brief guide detailing my research setting up various **SMTP server** builds for carrying out common **Red Team Phishing Operations**.

_________________________________________________________________________________________________

  ```python
   /~~~/
  (Ò‚`_Â´)        
  <,ï¸»â•¦â•¤â”€ ðŸ“§   ðŸ“§   ðŸ“§   ðŸ“§   ðŸ“§   ðŸ“§   ðŸ“§   ðŸ“§   ðŸ“§   ðŸ“§   ðŸ“§   ðŸ“§
  ```

_________________________________________________________________________________________________

  ![Image](https://raw.githubusercontent.com/m3rcer/m3rcer.github.io/master/_posts/redteaming/PhishOPS/images/postfix_install_34.png)

_________________________________________________________________________________________________

## Index 

- [Overview](#overview)
- [Methods](#methods)
- [Spoofing and Evasion](#spoofing-and-evasion)
- [Impact](#impact)
- [Issues](#issues)
- [Infrastructure](#infrastructure)
- [Screenshots](#screenshots)
- [References](#references)

_________________________________________________________________________________________________

## Overview

* Understand various methods to implement a SMTP server to use alongside your phishing Operations.
* Achieve scores as below to bypass spam filters.
  - Surpass `9/10` in overall deliverability on [mail tester](https://mail-tester.com)
  - Score a spam score of `<0` on [SpamAssasin's Json api](https://spamcheck.postmarkapp.com/)
* Understand a Red Team mindset while engaging various SMTP relays.
* Spoofing and Evasion Tradecraft to reduce MTA Endpoint Detection.

_________________________________________________________________________________________________


## Methods

Below are detailed hyperlinks to setup and engage various SMTP servers

1. __â­[Build your Local SMTP Server on a VPS](/permalinks/PhishOPS/localsmtp)â­__
2. __[Abuse an External Cloud Provideded SMTP Server](/permalinks/PhishOPS/Cloudsmtp)__
3. __[Pentesting Exposed SMTP Relays & Exchange Servers](/permalinks/PhishOPS/directsmtp)__

*NOTE: All numbering below is in accordance to the specified methods listed here*

_________________________________________________________________________________________________

## Spoofing and Evasion

- [Spoofing/Evasion Tradecraft to reduce MTA Endpoint Detection for the discussed builds](/permalinks/PhishOPS/PhishNSpoof)
  - `Important:` The longer you mature your domains, or grab an expired/lapsed domain or reconfig one the better will be your MTA deliverability. I found this to be a core factor in MTA deliverability.

_________________________________________________________________________________________________

## Impact

Each method listed should be used accordingly when oppurtunity presents itself.
  1. The 1st method is less used and termed dated by the community in my opinion because of how cumbersome a process it is to build a fully functional SMTP server with all the checks to bypass modern MTA filters. 
  **I would mainly like to emphasize this method of building your own SMTP as it still does yield hearty results from what i've researched. It's a lengthy process but if done right can lead to great scores and can bypass most modern day spam filters. Also spoofing  would be possible and how good would depend on your creativity, this would work still without changing its deliverability/spam score.** 
  2. The fastest to setup and no brainer would be to use a cloud provided relay. This was fairly easy to setup and abuse for the past years as many providers offered free mail relays and the popular ones did offer good deliverability so you would be assured it would land through the primary/secondary inbox and not spam. But there are increased checks with the reputable cloud providers and the ones that accept easy sign up's have weakly setup SMTP relays making deliverability/spam score not up to the mark.
  3. When you find a vulnerable mail server/poorly configured open relay, blindly abuse the 3rd method to connect directly and engage the target SMTP as an open relay and abuse its trust internally by using the server to mail internal clients if such an oppurtunity where to arise. Pull up some [Hacktricks](https://book.hacktricks.xyz/pentesting/pentesting-smtp) and get on SMTP pentesting.
  Easy, but I feel it is a rarity to find such an implementation in today's day. If you do, you know what to do and you most likely would bypass the spam filter too and land in straight through the primary inbox abusing the interal MTA's trust and deliverability.

_________________________________________________________________________________________________

## Issues

1. Quite challenging to build and setup. 
2. Only the popular and reputable providers bypass most filters well and as stated have increased checks at play now to establish an infrastructure. Also they hinder with what you can and not do(spoofing, content, background checks).
3. This would be the best outcome that is if your target has an open relay or poor authentication blindly go for it. Sadly the number of open relays/exchange servers seems to decline.

_________________________________________________________________________________________________

## Infrastructure

If you've setup your C2 you'd mostly follow/be familiar with an Infrastructure of sorts:

  > Staging Server - For initial callbacks, initial privesc, exploitation and an initial foothold.

  > Long-Haul Server - Low and slow persistent callbacks. Setup for longterm access and passes sessions to the post exploitation server.

  > Post-Exploitation Server - Exfiltration, privesc, lateral movement.

The Staging/Post-Exploitation Server depending on your setup might most likely be traced and get caught, that's one of the aspects this server is made to handle. Hence it should be a disposable and instant to spawn/clone on another host server if a threat to were to arise. **These servers would make a good candidate to host our SMTP server**.

It definitely would be cumbersome to rebuild the local mail server again and again if your server is taken down/detected hence it would be smart to create a backup of your server or use a bash script to automate this process to build one on the fly.

Some useful scripts:
  - [n0pe-sled/Postfix-Server-Setup](https://github.com/n0pe-sled/Postfix-Server-Setup/blob/master/ServerSetup.sh) 
  - [jamesm0rr1s/Mail-Server-Setup-for-Phishing](https://github.com/jamesm0rr1s/Mail-Server-Setup-for-Phishing)

_________________________________________________________________________________________________

## Screenshots

**Primary Inbox Check:**
  Gmail
  ![Image](https://raw.githubusercontent.com/m3rcer/m3rcer.github.io/master/_posts/redteaming/PhishOPS/images/postfix_install_36.png)
  Yahoo
  ![Image](https://raw.githubusercontent.com/m3rcer/m3rcer.github.io/master/_posts/redteaming/PhishOPS/images/postfix_install_37.png)
**SPF and DKIM Check:**
  ![Image](https://raw.githubusercontent.com/m3rcer/m3rcer.github.io/master/_posts/redteaming/PhishOPS/images/postfix_install_33.png)
**Email Score and Placement:**
  ![Image](https://raw.githubusercontent.com/m3rcer/m3rcer.github.io/master/_posts/redteaming/PhishOPS/images/postfix_install_34.png)
**SpamAssasin API:**
  ![Image](https://raw.githubusercontent.com/m3rcer/m3rcer.github.io/master/_posts/redteaming/PhishOPS/images/postfix_install_35.png)


_________________________________________________________________________________________________

## References

- https://www.linuxbabe.com/mail-server/setup-basic-postfix-mail-sever-ubuntu
- https://luemmelsec.github.io/Pentest-Everything-SMTP/
- https://book.hacktricks.xyz/pentesting/pentesting-smtp

