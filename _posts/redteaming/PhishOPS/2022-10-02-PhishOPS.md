---
title: PhishOPS
date: 2021-06-08 09:48:47 +07:00
categories: RedTeaming
#modified: 20-08-29 09:24:47 +07:00
#tags: [blog, netlify, jekyll, github]
description: Dark/Clear Web Hosting Providers for your SMTP builds!
---

<h3 align="center">Red Team Phishing Operations and Builds</h3>

This is a brief guide detailing my research setting up various SMTP server builds for phishing operations.

You will -->

* Understand methods to implement a phishing/SMTP server to use alongside your phishing Ops.

* Achieve scores like and bypass most spam filters:

  > Surpass 9/10 in overall deliverability on mail-tester.com

  > Score a spam score of < 0 on SpamAssasin Json api.

* Engage and understand the pentest mindset with various SMTP relays.

* Understand trivial Spoofing and Evasion Tradecraft to reduce endpoint detection.

_________________________________________________________________________________________________


## Red Team Phishing/SMTP Ops:

* __Get a short brief on best practices for Spam Filter bypasses before delving into any mentioned method:__

   > [Starting Point](Starting_Point.md)  

* __There are broadly 3 ways a SMTP server can be implemented in red team attacks/ops .__

- Select your pick and dive in:
 
  __1. ⭐[Build your own local SMTP server.](https://github.com/m3rcer/Red-Team-SMTP-Spam-Filter-Bypass/blob/main/local_smtp.md)⭐__

  __2. [Use an external cloud provided SMTP server.](https://github.com/m3rcer/Red-Team-SMTP-Spam-Filter-Bypass/blob/main/Cloud-smtp.md)__

  __3. [Engage and pentest the SMTP relays directly .](https://github.com/m3rcer/Red-Team-SMTP-Spam-Filter-Bypass/blob/main/direct-smtp.md)__

- __Spoofing and Evasion:__

  > [Spoofing and Evasion](https://github.com/m3rcer/Red-Team-SMTP-Spam-Filter-Bypass/blob/main/PhishNSpoof.md)

_Major Tip: The longer you mature your domains like wine , or grab an expired/lapsed domain, and reconfig it, the stronger your deliverability and MTA rep._

_________________________________________________________________________________________________

### Impact:

Each method listed should be used accordingly when oppurtunity presents itself (numbering is in accordance to the specified methods listed above) .

For instance -->

  1. The 1st method is less used and and dated by the community because of how cumbersome of a process it is to build one yourself. 
  **I would mainly like to emphasize/explain this style/method of building your own SMTP as it still does yield hearty results. It's a lengthy process but if done right can lead to great scores and bypass most spam filters. Also spoofing (not the headers) would be possible and how good would depend on your creativity, this would work without changing its deliverability/spam score. Wonderful..** 

  2. The fastest to setup and no brainer would be to use a cloud provided relay as option. This was fairly easy to setup and abuse for the past years as many providers offered free mail relays and the popular ones did offer good deliverability so you would be assured it would land through the primary /secondary inbox and not spam. But there are increased checks with the reputable providers and the ones that accept easy sign up's have weakly setup SMTP relays making deliverability not up to the mark.

  3. When you find a vulnerable mail server/poorly configured open relay... Blindly go with the 3rd method and connect directly to engage the target SMTP as an open relay and abuse its trust internally by using the server to mail internal clients if such an oppurtunity where to arise. Pull up some "Hacktricks" and get on pentesting.
  Easy.... Only if they were  more commonly found in today's day. If you do, you know what to do and you most likely would bypass the spam filter too and land in straight through the primary inbox.

_________________________________________________________________________________________________

### Issues faced:

  1. Quite challenging to build and setup. 

  2. This would expectedly be the most reliable option to abuse the trust of an established 3rd party mail provider to reliably bypass the spam filter but yet again, only the popular and reputable providers bypass most filters well and as stated have increased checks at play now to establish an infrastructure. Also they hinder with what you can and not do(spoofing, content, background checks).

  3. This would be the best outcome that is if your target has an open relay or poor authentication blindly go for it. Sadly the number of open relays seems to decline as TLS is widely started to be adopted with added security. 

_________________________________________________________________________________________________

### SMTP Infrastructure in Red Team Land:

If you've setup your C2 you'd mostly follow/be familiar with an Infrastructure of sorts:

  > Staging Server - For initial callbacks, initial privesc, exploitation and an initial foothold.

  > Long-Haul Server - Low and slow persistent callbacks. Setup for longterm access and passes sessions to the post exploitation server.

  > Post-Exploitation Server - Exfiltration, privesc, lateral movement.

* The Staging/Post-Exploitation Server depending on your setup might most likely be traced and get caught, that's one of the aspects this server is made to handle. Hence it should be a disposable and instant to spawn/clone on another host server if a threat to were to arise. **These servers would make a good candidate to host our SMTP server**.


* It definitely would be cumbersome to rebuild the local mail server again and again if your server is taken down/detected hence it would be smart to create a backup of your server or use a bash script to automate this process to build one on the fly.

  - Some useful scripts:

    * [n0pe-sled/Postfix-Server-Setup](https://github.com/n0pe-sled/Postfix-Server-Setup/blob/master/ServerSetup.sh) 

    * [jamesm0rr1s/Mail-Server-Setup-for-Phishing](https://github.com/jamesm0rr1s/Mail-Server-Setup-for-Phishing)

_________________________________________________________________________________________________

## Result:


1. **Primary Inbox Check:**

  - Gmail:

    - ![Image](https://github.com/m3rcer/Red-Team-SMTP-Spam-Filter-Bypass/blob/main/images/postfix_install_36.png)

  - Yahoo:

    - ![Image](https://github.com/m3rcer/Red-Team-SMTP-Spam-Filter-Bypass/blob/main/images/postfix_install_37.png)


2. **SPF and DKIM Check:**

    - ![Image](https://github.com/m3rcer/Red-Team-SMTP-Spam-Filter-Bypass/blob/main/images/postfix_install_33.png)


3. **Email Score and Placement:**

    - ![Image](https://github.com/m3rcer/Red-Team-SMTP-Spam-Filter-Bypass/blob/main/images/postfix_install_34.png)

4. **SpamAssasin API:**

    - ![Image](https://github.com/m3rcer/Red-Team-SMTP-Spam-Filter-Bypass/blob/main/images/postfix_install_35.png)


_________________________________________________________________________________________________

### References:

  - https://www.linuxbabe.com/mail-server/setup-basic-postfix-mail-sever-ubuntu

  - https://luemmelsec.github.io/Pentest-Everything-SMTP/

  - https://book.hacktricks.xyz/pentesting/pentesting-smtp

_________________________________________________________________________________________________

```python
 /~~~/
(҂`_´)        
<,︻╦╤─ 📧   📧   📧   📧   📧   📧   📧   📧   📧   📧   📧   📧   📧   📧   📧   📧   📧    
 /﹋\
```

_________________________________________________________________________________________________
